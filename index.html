<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Škodní protokol - Rohlik.cz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* CSS pro tisk a PDF export - A4 formát */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
                font-size: 11pt;
                line-height: 1.4;
                color: black !important;
            }

            .container {
                max-width: none !important;
                width: 210mm;
                min-height: 297mm;
                margin: 0 auto;
                background: white !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                border: none !important;
                page-break-inside: avoid;
            }

            .header {
                background: #00c851 !important;
                color: white !important;
                padding: 15mm !important;
                margin: 0 !important;
                page-break-inside: avoid;
            }

            .header::before {
                display: none !important;
            }

            .header h1 {
                font-size: 18pt !important;
                margin-bottom: 5mm !important;
            }

            .header-subtitle {
                font-size: 12pt !important;
            }

            .company-info {
                background: #f8f9fa !important;
                padding: 10mm !important;
                border-bottom: 2pt solid #00c851 !important;
                font-size: 16pt !important;
                page-break-inside: avoid;
            }

            .progress-bar {
                display: none !important;
            }

            .form-content {
                padding: 15mm !important;
                background: white !important;
            }

            .form-section {
                background: white !important;
                margin-bottom: 8mm !important;
                padding: 5mm !important;
                border: 1pt solid #ddd !important;
                border-radius: 3mm !important;
                box-shadow: none !important;
                page-break-inside: avoid;
            }

            .form-section:hover {
                transform: none !important;
                box-shadow: none !important;
            }

            .form-section::before {
                height: 2pt !important;
                background: #00c851 !important;
            }

            .main-label {
                font-size: 12pt !important;
                font-weight: bold !important;
                margin-bottom: 5mm !important;
                color: black !important;
            }

            .form-row {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 5mm !important;
                margin-bottom: 5mm !important;
            }

            label {
                font-size: 10pt !important;
                font-weight: bold !important;
                margin-bottom: 2mm !important;
                color: black !important;
            }

            input[type="text"],
            input[type="date"],
            input[type="time"],
            select,
            textarea {
                border: 1pt solid #999 !important;
                border-radius: 2mm !important;
                padding: 3mm !important;
                font-size: 10pt !important;
                background: white !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
            }

            .current-time {
                background: #e3f2fd !important;
                border: 1pt solid #1976d2 !important;
                padding: 5mm !important;
                border-radius: 2mm !important;
                font-size: 10pt !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
            }

            .signature-section {
                background: #f8f9fa !important;
                border: 1pt solid #ddd !important;
                padding: 5mm !important;
                border-radius: 2mm !important;
                -webkit-print-color-adjust: exact;
            }

            .signature-pad {
                border: 1pt solid #999 !important;
                background: white !important;
                height: 40mm !important;
                -webkit-print-color-adjust: exact;
            }

            .signature-controls,
            .clear-btn,
            .upload-btn {
                display: none !important;
            }

            .photo-upload {
                border: 1pt dashed #00c851 !important;
                background: #f0f8f0 !important;
                padding: 10mm !important;
                text-align: center !important;
                -webkit-print-color-adjust: exact;
            }

            .photo-preview img {
                max-width: 30mm !important;
                max-height: 30mm !important;
                border: 1pt solid #ddd !important;
                margin: 1mm !important;
            }

            .submit-section,
            .submit-btn {
                display: none !important;
            }

            .currency-group {
                display: flex !important;
                align-items: center !important;
                gap: 2mm !important;
                border: 1pt solid #999 !important;
                border-radius: 2mm !important;
                padding: 1mm !important;
                background: white !important;
            }

            .currency-group input {
                border: none !important;
                background: transparent !important;
                flex: 1 !important;
            }

            .currency-group select {
                border: none !important;
                background: #f8f9fa !important;
                width: 20mm !important;
            }

            /* Specifické třídy pro dělení stránek */
            .page-break-before {
                page-break-before: always !important;
            }

            .page-break-after {
                page-break-after: always !important;
            }

            /* Zajištění správného dělení stránek */
            .form-section {
                page-break-inside: avoid;
            }

            /* Pokud je sekce příliš dlouhá, povol dělení */
            .form-section.allow-break {
                page-break-inside: auto;
            }

            /* Ikony v PDF */
            .section-icon,
            .rohlik-icon {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }

            /* Zajištění čitelnosti textu */
            * {
                color: black !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }

            /* Zachování barev pozadí pro důležité prvky */
            .header,
            .company-info,
            .current-time,
            .signature-section,
            .photo-upload {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
        }

        /* A4 rozměry pro náhled */
        @media screen and (min-width: 1200px) {
            .container {
                max-width: 210mm;
                min-height: 297mm;
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            background: linear-gradient(135deg, #00c851 0%, #ff6900 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.05) 10px,
                rgba(255,255,255,0.05) 20px
            );
            animation: slide 20s linear infinite;
        }

        @keyframes slide {
            0% { transform: translateX(-100px) translateY(-100px); }
            100% { transform: translateX(100px) translateY(100px); }
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header-subtitle {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .company-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid #00c851;
            font-size: 24px;
            font-weight: bold;
            color: #2d3436;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .rohlik-icon {
            width: 32px;
            height: 32px;
            display: inline-block;
        }

        .progress-bar {
            height: 6px;
            background: linear-gradient(90deg, #00c851 0%, #ff6900 100%);
            margin-bottom: 20px;
            border-radius: 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-content {
            padding: 40px;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
        }

        .form-section {
            background: white;
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.12);
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #00c851 0%, #ff6900 100%);
        }

        .section-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            margin-right: 12px;
            vertical-align: middle;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-col {
            display: flex;
            flex-direction: column;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2d3436;
            font-size: 14px;
            letter-spacing: 0.3px;
        }

        .main-label {
            font-size: 18px;
            margin-bottom: 20px;
            color: #2d3436;
            display: flex;
            align-items: center;
            font-weight: 700;
        }

        input[type="text"],
        input[type="date"],
        input[type="time"],
        select,
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #00c851;
            box-shadow: 0 0 0 4px rgba(0, 200, 81, 0.1);
            background: white;
            transform: translateY(-1px);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .photo-upload {
            border: 3px dashed #00c851;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: linear-gradient(135deg, rgba(0, 200, 81, 0.05) 0%, rgba(255, 105, 0, 0.05) 100%);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .photo-upload:hover {
            border-color: #ff6900;
            background: linear-gradient(135deg, rgba(0, 200, 81, 0.1) 0%, rgba(255, 105, 0, 0.1) 100%);
            transform: scale(1.02);
        }

        .photo-upload input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #00c851 0%, #ff6900 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 200, 81, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 200, 81, 0.4);
        }

        .signature-section {
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }

        .signature-pad {
            width: 100%;
            height: 180px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            background: white;
            cursor: crosshair;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
            transition: border-color 0.3s ease;
        }

        .signature-pad:hover {
            border-color: #00c851;
        }

        .signature-controls {
            margin-top: 15px;
            text-align: center;
        }

        .clear-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .clear-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .submit-section {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .submit-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .submit-btn {
            background: linear-gradient(135deg, #00c851 0%, #ff6900 100%);
            color: white;
            padding: 20px 50px;
            border: none;
            border-radius: 30px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 200, 81, 0.3);
            position: relative;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .submit-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 200, 81, 0.4);
        }

        .current-time {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
            text-align: center;
        }

        .currency-group {
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
            border-radius: 10px;
            padding: 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .currency-group input {
            border: none;
            background: transparent;
            flex: 1;
        }

        .currency-group select {
            width: 80px;
            border: none;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .photo-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .photo-preview img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .photo-preview img:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            body {
                padding: 10px;
            }
            
            .form-content {
                padding: 25px;
            }

            .form-section {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .submit-btn {
                padding: 15px 30px;
                font-size: 18px;
            }
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .success-animation {
            animation: successPulse 0.6s ease-in-out;
        }

        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛡️ Záznam o škodní události</h1>
            <div class="header-subtitle">Digitální protokol pro rychlé a přesné hlášení</div>
        </div>

        <div class="company-info">
            <svg class="rohlik-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <!-- Hlavní tvar croissantu -->
                <path d="M5 15 C5 15, 8 12, 12 10 C14 9, 16 8.5, 18 9.5 C19.5 10.2, 20 11.5, 19.5 12.5 C19 13.5, 17.5 14, 16 13.5 C15 13, 14.5 12, 14 11.5 C13.5 11, 13 10.8, 12.5 11 C12 11.2, 11.5 11.8, 11 12.5 C10.5 13.2, 9.8 14, 8.5 14.8 C7.2 15.6, 5.8 16, 4.5 15.5 C3.8 15.2, 3.5 14.5, 4 13.8 Z" fill="#D4AF37"/>
                
                <!-- Světlejší vrstva pro hloubku -->
                <path d="M5.5 14.5 C5.5 14.5, 8.5 11.8, 12 10 C13.8 9.2, 15.5 8.8, 17 9.5 C18.2 10, 18.5 11, 18 11.8 C17.5 12.6, 16.5 13, 15.5 12.8 C14.8 12.6, 14.3 12, 13.8 11.5 C13.3 11, 12.8 10.9, 12.4 11.1 C12 11.3, 11.6 11.8, 11.2 12.3 C10.8 12.8, 10.2 13.5, 9.2 14 C8.2 14.5, 7 14.8, 6 14.5 C5.3 14.3, 5.1 13.8, 5.5 13.2 Z" fill="#F4D03F"/>
                
                <!-- Nejsvětlejší část -->
                <path d="M6 14 C6 14, 9 11.5, 11.8 10.2 C13.2 9.5, 14.5 9.2, 15.5 9.6 C16.3 9.9, 16.5 10.5, 16.2 11 C15.9 11.5, 15.2 11.7, 14.5 11.5 C14 11.3, 13.7 10.9, 13.4 10.6 C13.1 10.3, 12.8 10.2, 12.6 10.3 C12.4 10.4, 12.2 10.7, 12 11 C11.8 11.3, 11.4 11.8, 10.8 12.1 C10.2 12.4, 9.5 12.5, 8.8 12.3 C8.3 12.1, 8.1 11.7, 8.3 11.3 Z" fill="#FFE4B5"/>
                
                <!-- Vroubky na povrchu croissantu -->
                <ellipse cx="10" cy="12" rx="0.3" ry="0.8" fill="#CD853F" opacity="0.6"/>
                <ellipse cx="12" cy="10.5" rx="0.3" ry="0.8" fill="#CD853F" opacity="0.6"/>
                <ellipse cx="14" cy="10" rx="0.3" ry="0.6" fill="#CD853F" opacity="0.6"/>
            </svg>
            Rohlik.cz
        </div>

        <div class="progress-bar"></div>

        <div class="form-content">
            <!-- Kdy došlo k oznámení -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">⏰ 3. Kdy došlo k oznámení události</label>
                    <div class="current-time" id="current-time">
                        📅 Automaticky zaznamenáno: <span id="auto-time"></span>
                    </div>
                </div>
            </div>

            <!-- Kdy došlo k události -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">📋 4. Kdy došlo k události</label>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="incident-date">📅 Datum</label>
                            <input type="date" id="incident-date" required>
                        </div>
                        <div class="form-col">
                            <label for="incident-time-input">🕐 Čas</label>
                            <input type="time" id="incident-time-input" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kdo oznámil -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">👤 5. Kdo událost oznámil</label>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="reporter-name">👨‍💼 Jméno a příjmení</label>
                            <input type="text" id="reporter-name" placeholder="Jméno a příjmení" required>
                        </div>
                        <div class="form-col">
                            <label for="reporter-position">💼 Pracovní pozice</label>
                            <input type="text" id="reporter-position" placeholder="Pracovní pozice" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="reporter-id">🔢 Os. č.</label>
                            <input type="text" id="reporter-id" placeholder="Osobní číslo" required>
                        </div>
                        <div class="form-col">
                            <label for="reporter-company">🏢 Firma</label>
                            <input type="text" id="reporter-company" placeholder="Název firmy" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kdo způsobil -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">⚠️ 6. Kdo událost způsobil</label>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="perpetrator-name">👨‍💼 Jméno a příjmení</label>
                            <input type="text" id="perpetrator-name" placeholder="Jméno a příjmení" required>
                        </div>
                        <div class="form-col">
                            <label for="perpetrator-position">💼 Pracovní pozice</label>
                            <input type="text" id="perpetrator-position" placeholder="Pracovní pozice" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="perpetrator-id">🔢 Os. č.</label>
                            <input type="text" id="perpetrator-id" placeholder="Osobní číslo" required>
                        </div>
                        <div class="form-col">
                            <label for="perpetrator-company">🏢 Firma</label>
                            <input type="text" id="perpetrator-company" placeholder="Název firmy" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kde se stalo -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">📍 7. Kde k události došlo</label>
                    <select id="location" required>
                        <option value="">📍 Vyberte místo události...</option>
                        <option value="Trnkova 3118/119C, 628 00, Brno">🏢 Trnkova 3118/119C, 628 00, Brno</option>
                        <option value="Masná 27/9, 602 00, Brno">🏢 Masná 27/9, 602 00, Brno</option>
                    </select>
                    <input type="text" id="location-detail" placeholder="🎯 Přesné místo (hala, sekce, číslo regálu apod.)" style="margin-top: 15px;" required>
                </div>
            </div>

            <!-- Co bylo poškozeno -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">💥 8. Co bylo poškozeno</label>
                    <select id="damage-type" required>
                        <option value="">💥 Vyberte typ poškození...</option>
                        <option value="Regál stojina">🏗️ Regál stojina</option>
                        <option value="Regál nosník">🔧 Regál nosník</option>
                        <option value="Regál police">📦 Regál police</option>
                        <option value="Galerie">🏛️ Galerie</option>
                        <option value="Zeď">🧱 Zeď</option>
                        <option value="Elektroinstalace">⚡ Elektroinstalace</option>
                        <option value="Vozík / klec">🛒 Vozík / klec</option>
                    </select>
                    <textarea id="damage-description" placeholder="📝 Stručný popis poškození..." style="margin-top: 15px;" required></textarea>
                </div>
            </div>

            <!-- Jak došlo k události -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">❓ 9. Jak došlo k události</label>
                    <select id="cause-type" required>
                        <option value="">❓ Vyberte příčinu...</option>
                        <option value="Nepozornost">😴 Nepozornost</option>
                        <option value="Nedbalost">🤷 Nedbalost</option>
                        <option value="Porušení BOZP">⚠️ Porušení BOZP</option>
                        <option value="Technická závada">🔧 Technická závada</option>
                    </select>
                </div>
            </div>

            <!-- Čím bylo způsobeno -->
            <div class="form-section page-break-before">
                <div class="form-group">
                    <label class="main-label">🔍 10. Čím bylo způsobeno</label>
                    <textarea id="cause-detail" placeholder="📋 Detailní popis příčiny události..." required></textarea>
                </div>
            </div>

            <!-- Odhadovaná škoda -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">💰 11. Odhadovaná škoda</label>
                    <div class="currency-group">
                        <input type="text" id="estimated-damage" placeholder="💲 Zadejte částku" required>
                        <select id="currency">
                            <option value="CZK">🇨🇿 Kč</option>
                            <option value="EUR">🇪🇺 €</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Vyjádření viníka -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">💬 12. Vyjádření viníka</label>
                    <textarea id="perpetrator-statement" placeholder="💭 Vyjádření viníka k události..."></textarea>
                </div>
            </div>

            <!-- Nahrání fotek -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">📸 13. Nahrání fotografií (max. 4)</label>
                    <div class="photo-upload" onclick="document.getElementById('photos').click()">
                        <input type="file" id="photos" accept="image/*" multiple>
                        <button type="button" class="upload-btn">📷 Nahrát fotografie</button>
                        <p style="margin-top: 15px; color: #636e72; font-weight: 500;">📱 Klikněte pro výběr až 4 fotografií</p>
                        <div id="photo-preview" class="photo-preview"></div>
                    </div>
                </div>
            </div>

            <!-- Podpis viníka -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">✍️ 14. Podpis viníka *</label>
                    <div class="signature-section">
                        <canvas id="signature-perpetrator" class="signature-pad"></canvas>
                        <div class="signature-controls">
                            <button type="button" class="clear-btn" onclick="clearSignature('signature-perpetrator')">🗑️ Vymazat podpis</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Podpis security/vedoucího -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">✍️ 15. Podpis security / vedoucího *</label>
                    <div class="signature-section">
                        <canvas id="signature-supervisor" class="signature-pad"></canvas>
                        <div class="signature-controls">
                            <button type="button" class="clear-btn" onclick="clearSignature('signature-supervisor')">🗑️ Vymazat podpis</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="submit-section">
            <button type="button" class="submit-btn" onclick="submitForm()">
                🚀 Odeslat škodní protokol
            </button>
            <p style="margin-top: 15px; color: white; opacity: 0.8; font-size: 14px;">
                📧 PDF bude vygenerováno a odesláno emailem na david.rok@outlook.com<br>
                ✍️ POZOR: Oba podpisy jsou povinné pro odeslání protokolu!
            </p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Automatické vyplnění času oznámení
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('cs-CZ');
            document.getElementById('auto-time').textContent = timeString;
        }
        
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);

        // Podpisové pády s vylepšeními
        function initSignaturePad(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            // Nastavení rozměrů
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            ctx.strokeStyle = '#2d3436';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            function getEventPos(e) {
                const rect = canvas.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                return {
                    x: (clientX - rect.left) * (canvas.width / rect.width),
                    y: (clientY - rect.top) * (canvas.height / rect.height)
                };
            }
            
            function startDrawing(e) {
                isDrawing = true;
                const pos = getEventPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const pos = getEventPos(e);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            // Mouse události
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch události pro tablet
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startDrawing(e);
            });
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                draw(e);
            });
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopDrawing();
            });
        }
        
        // Inicializace podpisových pádů
        setTimeout(() => {
            initSignaturePad('signature-perpetrator');
            initSignaturePad('signature-supervisor');
        }, 200);
        
        // Vymazání podpisu s animací
        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Animace mazání
            let alpha = 1;
            const fadeOut = setInterval(() => {
                alpha -= 0.1;
                ctx.globalAlpha = alpha;
                if (alpha <= 0) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.globalAlpha = 1;
                    clearInterval(fadeOut);
                }
            }, 20);
        }
        
        // Formátování částky s oddělováním tisíců a animací
        document.getElementById('estimated-damage').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, ''); // Pouze čísla
            if (value) {
                // Přidání oddělovačů tisíců (mezera)
                value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
                // Animace při změně
                e.target.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    e.target.style.transform = 'scale(1)';
                }, 150);
            }
            e.target.value = value;
        });
        
        // Vylepšený náhled fotografií
        document.getElementById('photos').addEventListener('change', function(e) {
            const files = e.target.files;
            const preview = document.getElementById('photo-preview');
            preview.innerHTML = '';
            
            if (files.length > 4) {
                alert('📸 Můžete nahrát maximálně 4 fotografie');
                e.target.value = '';
                return;
            }
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.opacity = '0';
                    img.onload = function() {
                        // Animace načítání
                        img.style.transition = 'opacity 0.5s ease';
                        img.style.opacity = '1';
                    };
                    preview.appendChild(img);
                };
                
                reader.readAsDataURL(file);
            }
        });
        
        // Funkce pro sběr všech dat z formuláře
        function collectFormData() {
            // Získání hodnot ze všech polí
            const formData = {
                company: "Rohlik.cz",
                reportTime: document.getElementById('auto-time').textContent,
                incident: {
                    date: document.getElementById('incident-date').value,
                    time: document.getElementById('incident-time-input').value
                },
                reporter: {
                    name: document.getElementById('reporter-name').value,
                    position: document.getElementById('reporter-position').value,
                    employeeId: document.getElementById('reporter-id').value,
                    company: document.getElementById('reporter-company').value
                },
                perpetrator: {
                    name: document.getElementById('perpetrator-name').value,
                    position: document.getElementById('perpetrator-position').value,
                    employeeId: document.getElementById('perpetrator-id').value,
                    company: document.getElementById('perpetrator-company').value
                },
                location: {
                    address: document.getElementById('location').value,
                    detail: document.getElementById('location-detail').value
                },
                damage: {
                    type: document.getElementById('damage-type').value,
                    description: document.getElementById('damage-description').value
                },
                cause: {
                    type: document.getElementById('cause-type').value,
                    detail: document.getElementById('cause-detail').value
                },
                estimatedDamage: {
                    amount: document.getElementById('estimated-damage').value,
                    currency: document.getElementById('currency').value
                },
                perpetratorStatement: document.getElementById('perpetrator-statement').value,
                signatures: {
                    perpetrator: getSignatureData('signature-perpetrator'),
                    supervisor: getSignatureData('signature-supervisor')
                },
                photos: getPhotosData(),
                timestamp: new Date().toISOString(),
                formId: generateFormId()
            };

            return formData;
        }

        // Funkce pro získání dat podpisu
        function getSignatureData(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (canvas) {
                return {
                    dataUrl: canvas.toDataURL('image/png'),
                    isEmpty: isCanvasEmpty(canvas)
                };
            }
            return null;
        }

        // Kontrola zda je canvas prázdný
        function isCanvasEmpty(canvas) {
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            return !imageData.data.some(channel => channel !== 0);
        }

        // Funkce pro získání fotografií
        function getPhotosData() {
            const photosInput = document.getElementById('photos');
            const photos = [];
            
            if (photosInput.files.length > 0) {
                for (let i = 0; i < photosInput.files.length; i++) {
                    const file = photosInput.files[i];
                    photos.push({
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        lastModified: file.lastModified
                    });
                }
            }
            
            return photos;
        }

        // Generování unikátního ID formuláře
        function generateFormId() {
            return 'DAMAGE_' + new Date().getFullYear() + 
                   ('0' + (new Date().getMonth() + 1)).slice(-2) + 
                   ('0' + new Date().getDate()).slice(-2) + '_' +
                   Math.random().toString(36).substr(2, 9).toUpperCase();
        }

        // Funkce pro generování skutečného PDF pomocí jsPDF
        async function generatePDFData(formData) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Nastavení fontu
                doc.setFont("helvetica");
                
                // Hlavička
                doc.setFillColor(0, 200, 81);
                doc.rect(0, 0, 210, 30, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.text('🛡️ Záznam o škodní události', 105, 15, { align: 'center' });
                doc.setFontSize(16);
                doc.text('🥐 Rohlik.cz', 105, 25, { align: 'center' });
                
                // Reset barvy textu
                doc.setTextColor(0, 0, 0);
                let yPos = 45;
                
                // ID protokolu
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text('ID protokolu:', 20, yPos);
                doc.setFont("helvetica", "normal");
                doc.text(formData.formId, 60, yPos);
                yPos += 10;
                
                // Čas oznámení
                doc.setFont("helvetica", "bold");
                doc.text('⏰ Kdy došlo k oznámení:', 20, yPos);
                doc.setFont("helvetica", "normal");
                doc.text(formData.reportTime, 80, yPos);
                yPos += 15;
                
                // Událost
                doc.setFont("helvetica", "bold");
                doc.text('📋 ÚDAJE O UDÁLOSTI', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Datum události: ' + formData.incident.date, 20, yPos);
                yPos += 6;
                doc.text('Čas události: ' + formData.incident.time, 20, yPos);
                yPos += 15;
                
                // Oznamovatel
                doc.setFont("helvetica", "bold");
                doc.text('👤 KDO UDÁLOST OZNÁMIL', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Jméno: ' + formData.reporter.name, 20, yPos);
                yPos += 6;
                doc.text('Pozice: ' + formData.reporter.position, 20, yPos);
                yPos += 6;
                doc.text('Os. č.: ' + formData.reporter.employeeId, 20, yPos);
                yPos += 6;
                doc.text('Firma: ' + formData.reporter.company, 20, yPos);
                yPos += 15;
                
                // Viník
                doc.setFont("helvetica", "bold");
                doc.text('⚠️ KDO UDÁLOST ZPŮSOBIL', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Jméno: ' + formData.perpetrator.name, 20, yPos);
                yPos += 6;
                doc.text('Pozice: ' + formData.perpetrator.position, 20, yPos);
                yPos += 6;
                doc.text('Os. č.: ' + formData.perpetrator.employeeId, 20, yPos);
                yPos += 6;
                doc.text('Firma: ' + formData.perpetrator.company, 20, yPos);
                yPos += 15;
                
                // Místo
                doc.setFont("helvetica", "bold");
                doc.text('📍 MÍSTO UDÁLOSTI', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Adresa: ' + formData.location.address, 20, yPos);
                yPos += 6;
                doc.text('Přesné místo: ' + formData.location.detail, 20, yPos);
                yPos += 15;
                
                // Nová stránka pokud je potřeba
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
                
                // Poškození
                doc.setFont("helvetica", "bold");
                doc.text('💥 POŠKOZENÍ', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Typ: ' + formData.damage.type, 20, yPos);
                yPos += 6;
                const damageLines = doc.splitTextToSize('Popis: ' + formData.damage.description, 170);
                doc.text(damageLines, 20, yPos);
                yPos += damageLines.length * 6 + 10;
                
                // Příčina
                doc.setFont("helvetica", "bold");
                doc.text('❓ PŘÍČINA UDÁLOSTI', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Typ: ' + formData.cause.type, 20, yPos);
                yPos += 6;
                const causeLines = doc.splitTextToSize('Detailní popis: ' + formData.cause.detail, 170);
                doc.text(causeLines, 20, yPos);
                yPos += causeLines.length * 6 + 10;
                
                // Škoda
                doc.setFont("helvetica", "bold");
                doc.text('💰 ODHADOVANÁ ŠKODA', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text(formData.estimatedDamage.amount + ' ' + formData.estimatedDamage.currency, 20, yPos);
                yPos += 15;
                
                // Vyjádření viníka
                if (formData.perpetratorStatement) {
                    doc.setFont("helvetica", "bold");
                    doc.text('💬 VYJÁDŘENÍ VINÍKA', 20, yPos);
                    yPos += 8;
                    doc.setFont("helvetica", "normal");
                    const statementLines = doc.splitTextToSize(formData.perpetratorStatement, 170);
                    doc.text(statementLines, 20, yPos);
                    yPos += statementLines.length * 6 + 10;
                }
                
                // Podpisy
                doc.setFont("helvetica", "bold");
                doc.text('✍️ PODPISY', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Podpis viníka: ' + (formData.signatures.perpetrator && !formData.signatures.perpetrator.isEmpty ? 'Přítomen' : 'Chybí'), 20, yPos);
                yPos += 6;
                doc.text('Podpis vedoucího: ' + (formData.signatures.supervisor && !formData.signatures.supervisor.isEmpty ? 'Přítomen' : 'Chybí'), 20, yPos);
                yPos += 10;
                
                // Metadata
                doc.text('📸 Fotografie: ' + formData.photos.length + ' přiložených souborů', 20, yPos);
                yPos += 6;
                doc.text('📅 Vygenerováno: ' + new Date().toLocaleString('cs-CZ'), 20, yPos);
                
                // Získání PDF jako base64
                const pdfBase64 = doc.output('datauristring').split(',')[1];
                
                return {
                    filename: `protokol_${formData.formId}.pdf`,
                    content: pdfBase64,
                    mimeType: 'application/pdf'
                };
                
            } catch (error) {
                console.error('Chyba při generování PDF:', error);
                // Fallback na HTML verzi
                const htmlContent = generateHTMLForPDF(formData);
                const base64HTML = btoa(unescape(encodeURIComponent(htmlContent)));
                
                return {
                    filename: `protokol_${formData.formId}.html`,
                    content: base64HTML,
                    mimeType: 'text/html'
                };
            }
        }

        // Funkce pro odeslání PDF emailem přes Make
        function sendPDFEmail(formData, pdfData) {
            const webhookUrl = 'https://hook.eu2.make.com/xg110loy4xadvom33dxekme6jr8oxfjt';
            
            // Data pro email s PDF přílohou
            const makeData = {
                formId: formData.formId,
                timestamp: formData.timestamp,
                company: formData.company,
                reportTime: formData.reportTime,
                
                // Email data
                emailSubject: `Škodní protokol ${formData.formId} - ${formData.incident.date}`,
                emailTo: 'david.rok@outlook.com', // Zde zadejte cílový email
                emailBody: `
Dobrý den,

v příloze zasíláme škodní protokol s následujícími údaji:

📋 ID protokolu: ${formData.formId}
📅 Datum události: ${formData.incident.date} ${formData.incident.time}
📍 Místo: ${formData.location.address}
💥 Poškození: ${formData.damage.type}
💰 Škoda: ${formData.estimatedDamage.amount} ${formData.estimatedDamage.currency}

👤 Oznamovatel: ${formData.reporter.name} (${formData.reporter.position})
⚠️ Viník: ${formData.perpetrator.name} (${formData.perpetrator.position})

📄 Kompletní protokol najdete v příloze PDF.

S pozdravem,
Systém škodních protokolů Rohlik.cz
                `,
                
                // PDF příloha
                attachmentName: pdfData.filename,
                attachmentContent: pdfData.content, // base64 PDF data
                attachmentMimeType: 'application/pdf',
                
                // Metadata pro rozlišení
                incidentDate: formData.incident.date,
                incidentTime: formData.incident.time,
                reporterName: formData.reporter.name,
                perpetratorName: formData.perpetrator.name,
                locationAddress: formData.location.address,
                damageType: formData.damage.type,
                estimatedAmount: formData.estimatedDamage.amount,
                estimatedCurrency: formData.estimatedDamage.currency,
                
                // Flags pro Make
                actionType: 'sendEmail',
                hasPDFAttachment: true,
                pdfSize: pdfData.content.length
            };
            
            return fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(makeData)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(`HTTP ${response.status}: ${text}`);
                    });
                }
                return response.text().then(text => {
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        return { success: true, response: text };
                    }
                });
            });
        }

        // Funkce pro generování textového reportu
        function generateTextReport(formData) {
            return `ŠKODNÍ PROTOKOL - ${formData.company}
=====================================

ID protokolu: ${formData.formId}
Datum vytvoření: ${formData.reportTime}

ÚDAJE O UDÁLOSTI
===============
Datum události: ${formData.incident.date}
Čas události: ${formData.incident.time}

KDO UDÁLOST OZNÁMIL
==================
Jméno: ${formData.reporter.name}
Pozice: ${formData.reporter.position}
Osobní číslo: ${formData.reporter.employeeId}
Firma: ${formData.reporter.company}

KDO UDÁLOST ZPŮSOBIL
===================
Jméno: ${formData.perpetrator.name}
Pozice: ${formData.perpetrator.position}
Osobní číslo: ${formData.perpetrator.employeeId}
Firma: ${formData.perpetrator.company}

MÍSTO UDÁLOSTI
=============
Adresa: ${formData.location.address}
Přesné místo: ${formData.location.detail}

POŠKOZENÍ
=========
Typ: ${formData.damage.type}
Popis: ${formData.damage.description}

PŘÍČINA
=======
Typ: ${formData.cause.type}
Detailní popis: ${formData.cause.detail}

ŠKODA
=====
Výše: ${formData.estimatedDamage.amount} ${formData.estimatedDamage.currency}

${formData.perpetratorStatement ? `VYJÁDŘENÍ VINÍKA
================
${formData.perpetratorStatement}` : ''}

PODPISY
=======
Podpis viníka: ${formData.signatures.perpetrator && !formData.signatures.perpetrator.isEmpty ? 'Přítomen' : 'Chybí'}
Podpis vedoucího: ${formData.signatures.supervisor && !formData.signatures.supervisor.isEmpty ? 'Přítomen' : 'Chybí'}

Fotografie: ${formData.photos.length} přiložených souborů

=====================================
Vygenerováno: ${new Date().toLocaleString('cs-CZ')}`;
        }

        // Funkce pro generování HTML pro PDF
        function generateHTMLForPDF(formData) {
            return `
<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #00c851; color: white; padding: 20px; text-align: center; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .label { font-weight: bold; color: #333; }
        .value { margin-left: 10px; }
        .row { display: flex; gap: 20px; margin: 10px 0; }
        .col { flex: 1; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Záznam o škodní události</h1>
        <h2>Rohlik.cz</h2>
    </div>
    
    <div class="section">
        <div class="label">ID protokolu:</div>
        <div class="value">${formData.formId}</div>
    </div>
    
    <div class="section">
        <div class="label">Kdy došlo k oznámení:</div>
        <div class="value">${formData.reportTime}</div>
    </div>
    
    <div class="section">
        <h3>Kdy došlo k události</h3>
        <div class="row">
            <div class="col"><span class="label">Datum:</span> ${formData.incident.date}</div>
            <div class="col"><span class="label">Čas:</span> ${formData.incident.time}</div>
        </div>
    </div>
    
    <div class="section">
        <h3>Kdo událost oznámil</h3>
        <div class="row">
            <div class="col"><span class="label">Jméno:</span> ${formData.reporter.name}</div>
            <div class="col"><span class="label">Pozice:</span> ${formData.reporter.position}</div>
        </div>
        <div class="row">
            <div class="col"><span class="label">Os. č.:</span> ${formData.reporter.employeeId}</div>
            <div class="col"><span class="label">Firma:</span> ${formData.reporter.company}</div>
        </div>
    </div>
    
    <div class="section">
        <h3>Kdo událost způsobil</h3>
        <div class="row">
            <div class="col"><span class="label">Jméno:</span> ${formData.perpetrator.name}</div>
            <div class="col"><span class="label">Pozice:</span> ${formData.perpetrator.position}</div>
        </div>
        <div class="row">
            <div class="col"><span class="label">Os. č.:</span> ${formData.perpetrator.employeeId}</div>
            <div class="col"><span class="label">Firma:</span> ${formData.perpetrator.company}</div>
        </div>
    </div>
    
    <div class="section">
        <h3>Kde k události došlo</h3>
        <div class="label">Adresa:</div>
        <div class="value">${formData.location.address}</div>
        <div class="label">Přesné místo:</div>
        <div class="value">${formData.location.detail}</div>
    </div>
    
    <div class="section">
        <h3>Co bylo poškozeno</h3>
        <div class="label">Typ:</div>
        <div class="value">${formData.damage.type}</div>
        <div class="label">Popis:</div>
        <div class="value">${formData.damage.description}</div>
    </div>
    
    <div class="section">
        <h3>Jak došlo k události</h3>
        <div class="label">Příčina:</div>
        <div class="value">${formData.cause.type}</div>
        <div class="label">Detailní popis:</div>
        <div class="value">${formData.cause.detail}</div>
    </div>
    
    <div class="section">
        <h3>Odhadovaná škoda</h3>
        <div class="value">${formData.estimatedDamage.amount} ${formData.estimatedDamage.currency}</div>
    </div>
    
    ${formData.perpetratorStatement ? `
    <div class="section">
        <h3>Vyjádření viníka</h3>
        <div class="value">${formData.perpetratorStatement}</div>
    </div>
    ` : ''}
    
    <div class="section">
        <div class="label">Vygenerováno:</div>
        <div class="value">${new Date().toLocaleString('cs-CZ')}</div>
    </div>
</body>
</html>`;
        }

        // Vylepšené odeslání formuláře - PDF generování v prohlížeči
        async function submitForm() {
            const submitBtn = document.querySelector('.submit-btn');
            const container = document.querySelector('.container');
            
            // Kontrola povinných polí
            const requiredFields = [
                'incident-date', 'incident-time-input', 
                'reporter-name', 'reporter-position', 'reporter-id', 'reporter-company',
                'perpetrator-name', 'perpetrator-position', 'perpetrator-id', 'perpetrator-company',
                'location', 'location-detail', 'damage-type', 'damage-description',
                'cause-type', 'cause-detail', 'estimated-damage'
            ];
            
            let isValid = true;
            const missingFields = [];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim()) {
                    isValid = false;
                    const label = field?.previousElementSibling?.textContent || fieldId;
                    missingFields.push(label);
                    if (field) {
                        field.style.borderColor = '#e74c3c';
                        field.style.animation = 'shake 0.5s ease-in-out';
                    }
                } else {
                    if (field) field.style.borderColor = '#e9ecef';
                }
            });
            
            // Kontrola podpisů
            const perpetratorCanvas = document.getElementById('signature-perpetrator');
            const supervisorCanvas = document.getElementById('signature-supervisor');
            
            if (perpetratorCanvas && isCanvasEmpty(perpetratorCanvas)) {
                isValid = false;
                missingFields.push('✍️ Podpis viníka');
                perpetratorCanvas.style.borderColor = '#e74c3c';
                perpetratorCanvas.style.animation = 'shake 0.5s ease-in-out';
            } else if (perpetratorCanvas) {
                perpetratorCanvas.style.borderColor = '#ccc';
            }
            
            if (supervisorCanvas && isCanvasEmpty(supervisorCanvas)) {
                isValid = false;
                missingFields.push('✍️ Podpis security/vedoucího');
                supervisorCanvas.style.borderColor = '#e74c3c';
                supervisorCanvas.style.animation = 'shake 0.5s ease-in-out';
            } else if (supervisorCanvas) {
                supervisorCanvas.style.borderColor = '#ccc';
            }
            
            if (!isValid) {
                alert('❌ Prosím vyplňte všechna povinná pole a podpisy:\n\n' + missingFields.join('\n'));
                
                // Scroll k prvnímu chybějícímu podpisu
                if (perpetratorCanvas && isCanvasEmpty(perpetratorCanvas)) {
                    perpetratorCanvas.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else if (supervisorCanvas && isCanvasEmpty(supervisorCanvas)) {
                    supervisorCanvas.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                
                return;
            }
            
            // Animace načítání
            submitBtn.innerHTML = '⏳ Generuji PDF...';
            submitBtn.style.background = 'linear-gradient(135deg, #636e72 0%, #2d3436 100%)';
            container.classList.add('loading');
            
            try {
                // Sběr dat z formuláře
                const formData = collectFormData();
                
                // Generování PDF v prohlížeči
                const pdfData = await generatePDFData(formData);
                
                submitBtn.innerHTML = '⏳ Odesílám PDF...';
                
                // Odeslání PDF emailem
                const response = await sendPDFEmail(formData, pdfData);
                
                // Úspěšné odeslání
                submitBtn.innerHTML = '✅ PDF odesláno!';
                submitBtn.style.background = 'linear-gradient(135deg, #00b894 0%, #00a085 100%)';
                container.classList.remove('loading');
                container.classList.add('success-animation');
                
                setTimeout(() => {
                    alert('✅ PDF protokol byl úspěšně vygenerován a odeslán emailem!\n\n' +
                          '📧 Email s PDF: ' + pdfData.filename + '\n' +
                          '🆔 ID formuláře: ' + formData.formId + '\n' +
                          '📮 Odesláno na: david.rok@outlook.com');
                    
                    // Nabídka lokální kopie
                    const saveLocal = confirm('💾 Chcete si také uložit lokální kopii PDF?');
                    
                    if (saveLocal) {
                        // Spustí print dialog pro lokální uložení
                        preparePrintVersion();
                        setTimeout(() => {
                            window.print();
                            setTimeout(() => {
                                restoreNormalVersion();
                            }, 1000);
                        }, 500);
                    }
                    
                    // Reset tlačítka
                    setTimeout(() => {
                        submitBtn.innerHTML = '🚀 Odeslat škodní protokol';
                        submitBtn.style.background = 'linear-gradient(135deg, #00c851 0%, #ff6900 100%)';
                        container.classList.remove('success-animation');
                    }, 3000);
                }, 1000);
                
            } catch (error) {
                // Chyba při generování nebo odesílání
                submitBtn.innerHTML = '❌ Chyba při odesílání';
                submitBtn.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                container.classList.remove('loading');
                
                alert('❌ Chyba při generování nebo odesílání PDF:\n' + error.message + 
                      '\n\n💡 Zkuste to prosím znovu.');
                
                // Reset tlačítka po chybě
                setTimeout(() => {
                    submitBtn.innerHTML = '🚀 Odeslat škodní protokol';
                    submitBtn.style.background = 'linear-gradient(135deg, #00c851 0%, #ff6900 100%)';
                }, 3000);
            }
        }
        
        // Funkce pro přípravu verze na tisk
        function preparePrintVersion() {
            // Přidání datum a času tisku
            const printInfo = document.createElement('div');
            printInfo.id = 'print-info';
            printInfo.innerHTML = `<p style="font-size: 10pt; color: #666; text-align: right; margin: 10mm 15mm;">Vytištěno: ${new Date().toLocaleString('cs-CZ')}</p>`;
            document.querySelector('.form-content').appendChild(printInfo);
            
            // Označení dlouhých sekcí pro možné dělení stránek
            const longSections = document.querySelectorAll('.form-section');
            longSections.forEach(section => {
                if (section.offsetHeight > 200) {
                    section.classList.add('allow-break');
                }
            });
        }
        
        // Funkce pro obnovení normální verze
        function restoreNormalVersion() {
            // Odstranění print info
            const printInfo = document.getElementById('print-info');
            if (printInfo) {
                printInfo.remove();
            }
            
            // Odstranění allow-break tříd
            const breakSections = document.querySelectorAll('.allow-break');
            breakSections.forEach(section => {
                section.classList.remove('allow-break');
            });
        }
        
        // Funkce pro manuální export do PDF
        function exportToPDF() {
            preparePrintVersion();
            setTimeout(() => {
                window.print();
                setTimeout(() => {
                    restoreNormalVersion();
                }, 1000);
            }, 500);
        }
        
        // Responzivní úprava podpisových pádů
        window.addEventListener('resize', function() {
            setTimeout(() => {
                initSignaturePad('signature-perpetrator');
                initSignaturePad('signature-supervisor');
            }, 200);
        });
        
        // CSS animace pro chybějící pole
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>