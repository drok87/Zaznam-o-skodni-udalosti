<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈†kodn√≠ protokol - Rohlik.cz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* CSS pro tisk a PDF export - A4 form√°t */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
                font-size: 11pt;
                line-height: 1.4;
                color: black !important;
            }

            .container {
                max-width: none !important;
                width: 210mm;
                min-height: 297mm;
                margin: 0 auto;
                background: white !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                border: none !important;
                page-break-inside: avoid;
            }

            .header {
                background: #00c851 !important;
                color: white !important;
                padding: 15mm !important;
                margin: 0 !important;
                page-break-inside: avoid;
            }

            .header::before {
                display: none !important;
            }

            .header h1 {
                font-size: 18pt !important;
                margin-bottom: 5mm !important;
            }

            .header-subtitle {
                font-size: 12pt !important;
            }

            .company-info {
                background: #f8f9fa !important;
                padding: 10mm !important;
                border-bottom: 2pt solid #00c851 !important;
                font-size: 16pt !important;
                page-break-inside: avoid;
            }

            .progress-bar {
                display: none !important;
            }

            .form-content {
                padding: 15mm !important;
                background: white !important;
            }

            .form-section {
                background: white !important;
                margin-bottom: 8mm !important;
                padding: 5mm !important;
                border: 1pt solid #ddd !important;
                border-radius: 3mm !important;
                box-shadow: none !important;
                page-break-inside: avoid;
            }

            .form-section:hover {
                transform: none !important;
                box-shadow: none !important;
            }

            .form-section::before {
                height: 2pt !important;
                background: #00c851 !important;
            }

            .main-label {
                font-size: 12pt !important;
                font-weight: bold !important;
                margin-bottom: 5mm !important;
                color: black !important;
            }

            .form-row {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 5mm !important;
                margin-bottom: 5mm !important;
            }

            label {
                font-size: 10pt !important;
                font-weight: bold !important;
                margin-bottom: 2mm !important;
                color: black !important;
            }

            input[type="text"],
            input[type="date"],
            input[type="time"],
            select,
            textarea {
                border: 1pt solid #999 !important;
                border-radius: 2mm !important;
                padding: 3mm !important;
                font-size: 10pt !important;
                background: white !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
            }

            .current-time {
                background: #e3f2fd !important;
                border: 1pt solid #1976d2 !important;
                padding: 5mm !important;
                border-radius: 2mm !important;
                font-size: 10pt !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
            }

            .signature-section {
                background: #f8f9fa !important;
                border: 1pt solid #ddd !important;
                padding: 5mm !important;
                border-radius: 2mm !important;
                -webkit-print-color-adjust: exact;
            }

            .signature-pad {
                border: 1pt solid #999 !important;
                background: white !important;
                height: 40mm !important;
                -webkit-print-color-adjust: exact;
            }

            .signature-controls,
            .clear-btn,
            .upload-btn {
                display: none !important;
            }

            .photo-upload {
                border: 1pt dashed #00c851 !important;
                background: #f0f8f0 !important;
                padding: 10mm !important;
                text-align: center !important;
                -webkit-print-color-adjust: exact;
            }

            .photo-preview img {
                max-width: 30mm !important;
                max-height: 30mm !important;
                border: 1pt solid #ddd !important;
                margin: 1mm !important;
            }

            .submit-section,
            .submit-btn {
                display: none !important;
            }

            .currency-group {
                display: flex !important;
                align-items: center !important;
                gap: 2mm !important;
                border: 1pt solid #999 !important;
                border-radius: 2mm !important;
                padding: 1mm !important;
                background: white !important;
            }

            .currency-group input {
                border: none !important;
                background: transparent !important;
                flex: 1 !important;
            }

            .currency-group select {
                border: none !important;
                background: #f8f9fa !important;
                width: 20mm !important;
            }

            /* Specifick√© t≈ô√≠dy pro dƒõlen√≠ str√°nek */
            .page-break-before {
                page-break-before: always !important;
            }

            .page-break-after {
                page-break-after: always !important;
            }

            /* Zaji≈°tƒõn√≠ spr√°vn√©ho dƒõlen√≠ str√°nek */
            .form-section {
                page-break-inside: avoid;
            }

            /* Pokud je sekce p≈ô√≠li≈° dlouh√°, povol dƒõlen√≠ */
            .form-section.allow-break {
                page-break-inside: auto;
            }

            /* Ikony v PDF */
            .section-icon,
            .rohlik-icon {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }

            /* Zaji≈°tƒõn√≠ ƒçitelnosti textu */
            * {
                color: black !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }

            /* Zachov√°n√≠ barev pozad√≠ pro d≈Øle≈æit√© prvky */
            .header,
            .company-info,
            .current-time,
            .signature-section,
            .photo-upload {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
        }

        /* A4 rozmƒõry pro n√°hled */
        @media screen and (min-width: 1200px) {
            .container {
                max-width: 210mm;
                min-height: 297mm;
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            background: linear-gradient(135deg, #00c851 0%, #ff6900 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.05) 10px,
                rgba(255,255,255,0.05) 20px
            );
            animation: slide 20s linear infinite;
        }

        @keyframes slide {
            0% { transform: translateX(-100px) translateY(-100px); }
            100% { transform: translateX(100px) translateY(100px); }
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header-subtitle {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .company-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid #00c851;
            font-size: 24px;
            font-weight: bold;
            color: #2d3436;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .rohlik-icon {
            width: 32px;
            height: 32px;
            display: inline-block;
        }

        .progress-bar {
            height: 6px;
            background: linear-gradient(90deg, #00c851 0%, #ff6900 100%);
            margin-bottom: 20px;
            border-radius: 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-content {
            padding: 40px;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
        }

        .form-section {
            background: white;
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.12);
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #00c851 0%, #ff6900 100%);
        }

        .section-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            margin-right: 12px;
            vertical-align: middle;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-col {
            display: flex;
            flex-direction: column;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2d3436;
            font-size: 14px;
            letter-spacing: 0.3px;
        }

        .main-label {
            font-size: 18px;
            margin-bottom: 20px;
            color: #2d3436;
            display: flex;
            align-items: center;
            font-weight: 700;
        }

        input[type="text"],
        input[type="date"],
        input[type="time"],
        select,
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #00c851;
            box-shadow: 0 0 0 4px rgba(0, 200, 81, 0.1);
            background: white;
            transform: translateY(-1px);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .photo-upload {
            border: 3px dashed #00c851;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: linear-gradient(135deg, rgba(0, 200, 81, 0.05) 0%, rgba(255, 105, 0, 0.05) 100%);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .photo-upload:hover {
            border-color: #ff6900;
            background: linear-gradient(135deg, rgba(0, 200, 81, 0.1) 0%, rgba(255, 105, 0, 0.1) 100%);
            transform: scale(1.02);
        }

        .photo-upload input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #00c851 0%, #ff6900 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 200, 81, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 200, 81, 0.4);
        }

        .signature-section {
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }

        .signature-pad {
            width: 100%;
            height: 180px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            background: white;
            cursor: crosshair;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
            transition: border-color 0.3s ease;
        }

        .signature-pad:hover {
            border-color: #00c851;
        }

        .signature-controls {
            margin-top: 15px;
            text-align: center;
        }

        .clear-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .clear-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .submit-section {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .submit-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .submit-btn {
            background: linear-gradient(135deg, #00c851 0%, #ff6900 100%);
            color: white;
            padding: 20px 50px;
            border: none;
            border-radius: 30px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 200, 81, 0.3);
            position: relative;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .submit-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 200, 81, 0.4);
        }

        .current-time {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
            text-align: center;
        }

        .currency-group {
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
            border-radius: 10px;
            padding: 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .currency-group input {
            border: none;
            background: transparent;
            flex: 1;
        }

        .currency-group select {
            width: 80px;
            border: none;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .photo-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .photo-preview img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .photo-preview img:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            body {
                padding: 10px;
            }
            
            .form-content {
                padding: 25px;
            }

            .form-section {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .submit-btn {
                padding: 15px 30px;
                font-size: 18px;
            }
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .success-animation {
            animation: successPulse 0.6s ease-in-out;
        }

        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è Z√°znam o ≈°kodn√≠ ud√°losti</h1>
            <div class="header-subtitle">Digit√°ln√≠ protokol pro rychl√© a p≈ôesn√© hl√°≈°en√≠</div>
        </div>

        <div class="company-info">
            <svg class="rohlik-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <!-- Hlavn√≠ tvar croissantu -->
                <path d="M5 15 C5 15, 8 12, 12 10 C14 9, 16 8.5, 18 9.5 C19.5 10.2, 20 11.5, 19.5 12.5 C19 13.5, 17.5 14, 16 13.5 C15 13, 14.5 12, 14 11.5 C13.5 11, 13 10.8, 12.5 11 C12 11.2, 11.5 11.8, 11 12.5 C10.5 13.2, 9.8 14, 8.5 14.8 C7.2 15.6, 5.8 16, 4.5 15.5 C3.8 15.2, 3.5 14.5, 4 13.8 Z" fill="#D4AF37"/>
                
                <!-- Svƒõtlej≈°√≠ vrstva pro hloubku -->
                <path d="M5.5 14.5 C5.5 14.5, 8.5 11.8, 12 10 C13.8 9.2, 15.5 8.8, 17 9.5 C18.2 10, 18.5 11, 18 11.8 C17.5 12.6, 16.5 13, 15.5 12.8 C14.8 12.6, 14.3 12, 13.8 11.5 C13.3 11, 12.8 10.9, 12.4 11.1 C12 11.3, 11.6 11.8, 11.2 12.3 C10.8 12.8, 10.2 13.5, 9.2 14 C8.2 14.5, 7 14.8, 6 14.5 C5.3 14.3, 5.1 13.8, 5.5 13.2 Z" fill="#F4D03F"/>
                
                <!-- Nejsvƒõtlej≈°√≠ ƒç√°st -->
                <path d="M6 14 C6 14, 9 11.5, 11.8 10.2 C13.2 9.5, 14.5 9.2, 15.5 9.6 C16.3 9.9, 16.5 10.5, 16.2 11 C15.9 11.5, 15.2 11.7, 14.5 11.5 C14 11.3, 13.7 10.9, 13.4 10.6 C13.1 10.3, 12.8 10.2, 12.6 10.3 C12.4 10.4, 12.2 10.7, 12 11 C11.8 11.3, 11.4 11.8, 10.8 12.1 C10.2 12.4, 9.5 12.5, 8.8 12.3 C8.3 12.1, 8.1 11.7, 8.3 11.3 Z" fill="#FFE4B5"/>
                
                <!-- Vroubky na povrchu croissantu -->
                <ellipse cx="10" cy="12" rx="0.3" ry="0.8" fill="#CD853F" opacity="0.6"/>
                <ellipse cx="12" cy="10.5" rx="0.3" ry="0.8" fill="#CD853F" opacity="0.6"/>
                <ellipse cx="14" cy="10" rx="0.3" ry="0.6" fill="#CD853F" opacity="0.6"/>
            </svg>
            Rohlik.cz
        </div>

        <div class="progress-bar"></div>

        <div class="form-content">
            <!-- Kdy do≈°lo k ozn√°men√≠ -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">‚è∞ 3. Kdy do≈°lo k ozn√°men√≠ ud√°losti</label>
                    <div class="current-time" id="current-time">
                        üìÖ Automaticky zaznamen√°no: <span id="auto-time"></span>
                    </div>
                </div>
            </div>

            <!-- Kdy do≈°lo k ud√°losti -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">üìã 4. Kdy do≈°lo k ud√°losti</label>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="incident-date">üìÖ Datum</label>
                            <input type="date" id="incident-date" required>
                        </div>
                        <div class="form-col">
                            <label for="incident-time-input">üïê ƒåas</label>
                            <input type="time" id="incident-time-input" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kdo ozn√°mil -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">üë§ 5. Kdo ud√°lost ozn√°mil</label>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="reporter-name">üë®‚Äçüíº Jm√©no a p≈ô√≠jmen√≠</label>
                            <input type="text" id="reporter-name" placeholder="Jm√©no a p≈ô√≠jmen√≠" required>
                        </div>
                        <div class="form-col">
                            <label for="reporter-position">üíº Pracovn√≠ pozice</label>
                            <input type="text" id="reporter-position" placeholder="Pracovn√≠ pozice" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="reporter-id">üî¢ Os. ƒç.</label>
                            <input type="text" id="reporter-id" placeholder="Osobn√≠ ƒç√≠slo" required>
                        </div>
                        <div class="form-col">
                            <label for="reporter-company">üè¢ Firma</label>
                            <input type="text" id="reporter-company" placeholder="N√°zev firmy" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kdo zp≈Øsobil -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">‚ö†Ô∏è 6. Kdo ud√°lost zp≈Øsobil</label>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="perpetrator-name">üë®‚Äçüíº Jm√©no a p≈ô√≠jmen√≠</label>
                            <input type="text" id="perpetrator-name" placeholder="Jm√©no a p≈ô√≠jmen√≠" required>
                        </div>
                        <div class="form-col">
                            <label for="perpetrator-position">üíº Pracovn√≠ pozice</label>
                            <input type="text" id="perpetrator-position" placeholder="Pracovn√≠ pozice" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="perpetrator-id">üî¢ Os. ƒç.</label>
                            <input type="text" id="perpetrator-id" placeholder="Osobn√≠ ƒç√≠slo" required>
                        </div>
                        <div class="form-col">
                            <label for="perpetrator-company">üè¢ Firma</label>
                            <input type="text" id="perpetrator-company" placeholder="N√°zev firmy" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kde se stalo -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">üìç 7. Kde k ud√°losti do≈°lo</label>
                    <select id="location" required>
                        <option value="">üìç Vyberte m√≠sto ud√°losti...</option>
                        <option value="Trnkova 3118/119C, 628 00, Brno">üè¢ Trnkova 3118/119C, 628 00, Brno</option>
                        <option value="Masn√° 27/9, 602 00, Brno">üè¢ Masn√° 27/9, 602 00, Brno</option>
                    </select>
                    <input type="text" id="location-detail" placeholder="üéØ P≈ôesn√© m√≠sto (hala, sekce, ƒç√≠slo reg√°lu apod.)" style="margin-top: 15px;" required>
                </div>
            </div>

            <!-- Co bylo po≈°kozeno -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">üí• 8. Co bylo po≈°kozeno</label>
                    <select id="damage-type" required>
                        <option value="">üí• Vyberte typ po≈°kozen√≠...</option>
                        <option value="Reg√°l stojina">üèóÔ∏è Reg√°l stojina</option>
                        <option value="Reg√°l nosn√≠k">üîß Reg√°l nosn√≠k</option>
                        <option value="Reg√°l police">üì¶ Reg√°l police</option>
                        <option value="Galerie">üèõÔ∏è Galerie</option>
                        <option value="Zeƒè">üß± Zeƒè</option>
                        <option value="Elektroinstalace">‚ö° Elektroinstalace</option>
                        <option value="Voz√≠k / klec">üõí Voz√≠k / klec</option>
                    </select>
                    <textarea id="damage-description" placeholder="üìù Struƒçn√Ω popis po≈°kozen√≠..." style="margin-top: 15px;" required></textarea>
                </div>
            </div>

            <!-- Jak do≈°lo k ud√°losti -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">‚ùì 9. Jak do≈°lo k ud√°losti</label>
                    <select id="cause-type" required>
                        <option value="">‚ùì Vyberte p≈ô√≠ƒçinu...</option>
                        <option value="Nepozornost">üò¥ Nepozornost</option>
                        <option value="Nedbalost">ü§∑ Nedbalost</option>
                        <option value="Poru≈°en√≠ BOZP">‚ö†Ô∏è Poru≈°en√≠ BOZP</option>
                        <option value="Technick√° z√°vada">üîß Technick√° z√°vada</option>
                    </select>
                </div>
            </div>

            <!-- ƒå√≠m bylo zp≈Øsobeno -->
            <div class="form-section page-break-before">
                <div class="form-group">
                    <label class="main-label">üîç 10. ƒå√≠m bylo zp≈Øsobeno</label>
                    <textarea id="cause-detail" placeholder="üìã Detailn√≠ popis p≈ô√≠ƒçiny ud√°losti..." required></textarea>
                </div>
            </div>

            <!-- Odhadovan√° ≈°koda -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">üí∞ 11. Odhadovan√° ≈°koda</label>
                    <div class="currency-group">
                        <input type="text" id="estimated-damage" placeholder="üí≤ Zadejte ƒç√°stku" required>
                        <select id="currency">
                            <option value="CZK">üá®üáø Kƒç</option>
                            <option value="EUR">üá™üá∫ ‚Ç¨</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Vyj√°d≈ôen√≠ vin√≠ka -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">üí¨ 12. Vyj√°d≈ôen√≠ vin√≠ka</label>
                    <textarea id="perpetrator-statement" placeholder="üí≠ Vyj√°d≈ôen√≠ vin√≠ka k ud√°losti..."></textarea>
                </div>
            </div>

            <!-- Nahr√°n√≠ fotek -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">üì∏ 13. Nahr√°n√≠ fotografi√≠ (max. 4)</label>
                    <div class="photo-upload" onclick="document.getElementById('photos').click()">
                        <input type="file" id="photos" accept="image/*" multiple>
                        <button type="button" class="upload-btn">üì∑ Nahr√°t fotografie</button>
                        <p style="margin-top: 15px; color: #636e72; font-weight: 500;">üì± Kliknƒõte pro v√Ωbƒõr a≈æ 4 fotografi√≠</p>
                        <div id="photo-preview" class="photo-preview"></div>
                    </div>
                </div>
            </div>

            <!-- Podpis vin√≠ka -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">‚úçÔ∏è 14. Podpis vin√≠ka *</label>
                    <div class="signature-section">
                        <canvas id="signature-perpetrator" class="signature-pad"></canvas>
                        <div class="signature-controls">
                            <button type="button" class="clear-btn" onclick="clearSignature('signature-perpetrator')">üóëÔ∏è Vymazat podpis</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Podpis security/vedouc√≠ho -->
            <div class="form-section">
                <div class="form-group">
                    <label class="main-label">‚úçÔ∏è 15. Podpis security / vedouc√≠ho *</label>
                    <div class="signature-section">
                        <canvas id="signature-supervisor" class="signature-pad"></canvas>
                        <div class="signature-controls">
                            <button type="button" class="clear-btn" onclick="clearSignature('signature-supervisor')">üóëÔ∏è Vymazat podpis</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="submit-section">
            <button type="button" class="submit-btn" onclick="submitForm()">
                üöÄ Odeslat ≈°kodn√≠ protokol
            </button>
            <p style="margin-top: 15px; color: white; opacity: 0.8; font-size: 14px;">
                üìß PDF bude vygenerov√°no a odesl√°no emailem na david.rok@outlook.com<br>
                ‚úçÔ∏è POZOR: Oba podpisy jsou povinn√© pro odesl√°n√≠ protokolu!
            </p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Automatick√© vyplnƒõn√≠ ƒçasu ozn√°men√≠
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('cs-CZ');
            document.getElementById('auto-time').textContent = timeString;
        }
        
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);

        // Podpisov√© p√°dy s vylep≈°en√≠mi
        function initSignaturePad(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            // Nastaven√≠ rozmƒõr≈Ø
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            ctx.strokeStyle = '#2d3436';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            function getEventPos(e) {
                const rect = canvas.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                return {
                    x: (clientX - rect.left) * (canvas.width / rect.width),
                    y: (clientY - rect.top) * (canvas.height / rect.height)
                };
            }
            
            function startDrawing(e) {
                isDrawing = true;
                const pos = getEventPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const pos = getEventPos(e);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            // Mouse ud√°losti
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch ud√°losti pro tablet
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startDrawing(e);
            });
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                draw(e);
            });
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopDrawing();
            });
        }
        
        // Inicializace podpisov√Ωch p√°d≈Ø
        setTimeout(() => {
            initSignaturePad('signature-perpetrator');
            initSignaturePad('signature-supervisor');
        }, 200);
        
        // Vymaz√°n√≠ podpisu s animac√≠
        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Animace maz√°n√≠
            let alpha = 1;
            const fadeOut = setInterval(() => {
                alpha -= 0.1;
                ctx.globalAlpha = alpha;
                if (alpha <= 0) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.globalAlpha = 1;
                    clearInterval(fadeOut);
                }
            }, 20);
        }
        
        // Form√°tov√°n√≠ ƒç√°stky s oddƒõlov√°n√≠m tis√≠c≈Ø a animac√≠
        document.getElementById('estimated-damage').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, ''); // Pouze ƒç√≠sla
            if (value) {
                // P≈ôid√°n√≠ oddƒõlovaƒç≈Ø tis√≠c≈Ø (mezera)
                value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
                // Animace p≈ôi zmƒõnƒõ
                e.target.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    e.target.style.transform = 'scale(1)';
                }, 150);
            }
            e.target.value = value;
        });
        
        // Vylep≈°en√Ω n√°hled fotografi√≠
        document.getElementById('photos').addEventListener('change', function(e) {
            const files = e.target.files;
            const preview = document.getElementById('photo-preview');
            preview.innerHTML = '';
            
            if (files.length > 4) {
                alert('üì∏ M≈Ø≈æete nahr√°t maxim√°lnƒõ 4 fotografie');
                e.target.value = '';
                return;
            }
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.opacity = '0';
                    img.onload = function() {
                        // Animace naƒç√≠t√°n√≠
                        img.style.transition = 'opacity 0.5s ease';
                        img.style.opacity = '1';
                    };
                    preview.appendChild(img);
                };
                
                reader.readAsDataURL(file);
            }
        });
        
        // Funkce pro sbƒõr v≈°ech dat z formul√°≈ôe
        function collectFormData() {
            // Z√≠sk√°n√≠ hodnot ze v≈°ech pol√≠
            const formData = {
                company: "Rohlik.cz",
                reportTime: document.getElementById('auto-time').textContent,
                incident: {
                    date: document.getElementById('incident-date').value,
                    time: document.getElementById('incident-time-input').value
                },
                reporter: {
                    name: document.getElementById('reporter-name').value,
                    position: document.getElementById('reporter-position').value,
                    employeeId: document.getElementById('reporter-id').value,
                    company: document.getElementById('reporter-company').value
                },
                perpetrator: {
                    name: document.getElementById('perpetrator-name').value,
                    position: document.getElementById('perpetrator-position').value,
                    employeeId: document.getElementById('perpetrator-id').value,
                    company: document.getElementById('perpetrator-company').value
                },
                location: {
                    address: document.getElementById('location').value,
                    detail: document.getElementById('location-detail').value
                },
                damage: {
                    type: document.getElementById('damage-type').value,
                    description: document.getElementById('damage-description').value
                },
                cause: {
                    type: document.getElementById('cause-type').value,
                    detail: document.getElementById('cause-detail').value
                },
                estimatedDamage: {
                    amount: document.getElementById('estimated-damage').value,
                    currency: document.getElementById('currency').value
                },
                perpetratorStatement: document.getElementById('perpetrator-statement').value,
                signatures: {
                    perpetrator: getSignatureData('signature-perpetrator'),
                    supervisor: getSignatureData('signature-supervisor')
                },
                photos: getPhotosData(),
                timestamp: new Date().toISOString(),
                formId: generateFormId()
            };

            return formData;
        }

        // Funkce pro z√≠sk√°n√≠ dat podpisu
        function getSignatureData(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (canvas) {
                return {
                    dataUrl: canvas.toDataURL('image/png'),
                    isEmpty: isCanvasEmpty(canvas)
                };
            }
            return null;
        }

        // Kontrola zda je canvas pr√°zdn√Ω
        function isCanvasEmpty(canvas) {
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            return !imageData.data.some(channel => channel !== 0);
        }

        // Funkce pro z√≠sk√°n√≠ fotografi√≠
        function getPhotosData() {
            const photosInput = document.getElementById('photos');
            const photos = [];
            
            if (photosInput.files.length > 0) {
                for (let i = 0; i < photosInput.files.length; i++) {
                    const file = photosInput.files[i];
                    photos.push({
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        lastModified: file.lastModified
                    });
                }
            }
            
            return photos;
        }

        // Generov√°n√≠ unik√°tn√≠ho ID formul√°≈ôe
        function generateFormId() {
            return 'DAMAGE_' + new Date().getFullYear() + 
                   ('0' + (new Date().getMonth() + 1)).slice(-2) + 
                   ('0' + new Date().getDate()).slice(-2) + '_' +
                   Math.random().toString(36).substr(2, 9).toUpperCase();
        }

        // Funkce pro generov√°n√≠ skuteƒçn√©ho PDF pomoc√≠ jsPDF
        async function generatePDFData(formData) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Nastaven√≠ fontu
                doc.setFont("helvetica");
                
                // Hlaviƒçka
                doc.setFillColor(0, 200, 81);
                doc.rect(0, 0, 210, 30, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.text('üõ°Ô∏è Z√°znam o ≈°kodn√≠ ud√°losti', 105, 15, { align: 'center' });
                doc.setFontSize(16);
                doc.text('ü•ê Rohlik.cz', 105, 25, { align: 'center' });
                
                // Reset barvy textu
                doc.setTextColor(0, 0, 0);
                let yPos = 45;
                
                // ID protokolu
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text('ID protokolu:', 20, yPos);
                doc.setFont("helvetica", "normal");
                doc.text(formData.formId, 60, yPos);
                yPos += 10;
                
                // ƒåas ozn√°men√≠
                doc.setFont("helvetica", "bold");
                doc.text('‚è∞ Kdy do≈°lo k ozn√°men√≠:', 20, yPos);
                doc.setFont("helvetica", "normal");
                doc.text(formData.reportTime, 80, yPos);
                yPos += 15;
                
                // Ud√°lost
                doc.setFont("helvetica", "bold");
                doc.text('üìã √öDAJE O UD√ÅLOSTI', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Datum ud√°losti: ' + formData.incident.date, 20, yPos);
                yPos += 6;
                doc.text('ƒåas ud√°losti: ' + formData.incident.time, 20, yPos);
                yPos += 15;
                
                // Oznamovatel
                doc.setFont("helvetica", "bold");
                doc.text('üë§ KDO UD√ÅLOST OZN√ÅMIL', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Jm√©no: ' + formData.reporter.name, 20, yPos);
                yPos += 6;
                doc.text('Pozice: ' + formData.reporter.position, 20, yPos);
                yPos += 6;
                doc.text('Os. ƒç.: ' + formData.reporter.employeeId, 20, yPos);
                yPos += 6;
                doc.text('Firma: ' + formData.reporter.company, 20, yPos);
                yPos += 15;
                
                // Vin√≠k
                doc.setFont("helvetica", "bold");
                doc.text('‚ö†Ô∏è KDO UD√ÅLOST ZP≈ÆSOBIL', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Jm√©no: ' + formData.perpetrator.name, 20, yPos);
                yPos += 6;
                doc.text('Pozice: ' + formData.perpetrator.position, 20, yPos);
                yPos += 6;
                doc.text('Os. ƒç.: ' + formData.perpetrator.employeeId, 20, yPos);
                yPos += 6;
                doc.text('Firma: ' + formData.perpetrator.company, 20, yPos);
                yPos += 15;
                
                // M√≠sto
                doc.setFont("helvetica", "bold");
                doc.text('üìç M√çSTO UD√ÅLOSTI', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Adresa: ' + formData.location.address, 20, yPos);
                yPos += 6;
                doc.text('P≈ôesn√© m√≠sto: ' + formData.location.detail, 20, yPos);
                yPos += 15;
                
                // Nov√° str√°nka pokud je pot≈ôeba
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
                
                // Po≈°kozen√≠
                doc.setFont("helvetica", "bold");
                doc.text('üí• PO≈†KOZEN√ç', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Typ: ' + formData.damage.type, 20, yPos);
                yPos += 6;
                const damageLines = doc.splitTextToSize('Popis: ' + formData.damage.description, 170);
                doc.text(damageLines, 20, yPos);
                yPos += damageLines.length * 6 + 10;
                
                // P≈ô√≠ƒçina
                doc.setFont("helvetica", "bold");
                doc.text('‚ùì P≈ò√çƒåINA UD√ÅLOSTI', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Typ: ' + formData.cause.type, 20, yPos);
                yPos += 6;
                const causeLines = doc.splitTextToSize('Detailn√≠ popis: ' + formData.cause.detail, 170);
                doc.text(causeLines, 20, yPos);
                yPos += causeLines.length * 6 + 10;
                
                // ≈†koda
                doc.setFont("helvetica", "bold");
                doc.text('üí∞ ODHADOVAN√Å ≈†KODA', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text(formData.estimatedDamage.amount + ' ' + formData.estimatedDamage.currency, 20, yPos);
                yPos += 15;
                
                // Vyj√°d≈ôen√≠ vin√≠ka
                if (formData.perpetratorStatement) {
                    doc.setFont("helvetica", "bold");
                    doc.text('üí¨ VYJ√ÅD≈òEN√ç VIN√çKA', 20, yPos);
                    yPos += 8;
                    doc.setFont("helvetica", "normal");
                    const statementLines = doc.splitTextToSize(formData.perpetratorStatement, 170);
                    doc.text(statementLines, 20, yPos);
                    yPos += statementLines.length * 6 + 10;
                }
                
                // Podpisy
                doc.setFont("helvetica", "bold");
                doc.text('‚úçÔ∏è PODPISY', 20, yPos);
                yPos += 8;
                doc.setFont("helvetica", "normal");
                doc.text('Podpis vin√≠ka: ' + (formData.signatures.perpetrator && !formData.signatures.perpetrator.isEmpty ? 'P≈ô√≠tomen' : 'Chyb√≠'), 20, yPos);
                yPos += 6;
                doc.text('Podpis vedouc√≠ho: ' + (formData.signatures.supervisor && !formData.signatures.supervisor.isEmpty ? 'P≈ô√≠tomen' : 'Chyb√≠'), 20, yPos);
                yPos += 10;
                
                // Metadata
                doc.text('üì∏ Fotografie: ' + formData.photos.length + ' p≈ôilo≈æen√Ωch soubor≈Ø', 20, yPos);
                yPos += 6;
                doc.text('üìÖ Vygenerov√°no: ' + new Date().toLocaleString('cs-CZ'), 20, yPos);
                
                // Z√≠sk√°n√≠ PDF jako base64
                const pdfBase64 = doc.output('datauristring').split(',')[1];
                
                return {
                    filename: `protokol_${formData.formId}.pdf`,
                    content: pdfBase64,
                    mimeType: 'application/pdf'
                };
                
            } catch (error) {
                console.error('Chyba p≈ôi generov√°n√≠ PDF:', error);
                // Fallback na HTML verzi
                const htmlContent = generateHTMLForPDF(formData);
                const base64HTML = btoa(unescape(encodeURIComponent(htmlContent)));
                
                return {
                    filename: `protokol_${formData.formId}.html`,
                    content: base64HTML,
                    mimeType: 'text/html'
                };
            }
        }

        // Funkce pro odesl√°n√≠ PDF emailem p≈ôes Make
        function sendPDFEmail(formData, pdfData) {
            const webhookUrl = 'https://hook.eu2.make.com/xg110loy4xadvom33dxekme6jr8oxfjt';
            
            // Data pro email s PDF p≈ô√≠lohou
            const makeData = {
                formId: formData.formId,
                timestamp: formData.timestamp,
                company: formData.company,
                reportTime: formData.reportTime,
                
                // Email data
                emailSubject: `≈†kodn√≠ protokol ${formData.formId} - ${formData.incident.date}`,
                emailTo: 'david.rok@outlook.com', // Zde zadejte c√≠lov√Ω email
                emailBody: `
Dobr√Ω den,

v p≈ô√≠loze zas√≠l√°me ≈°kodn√≠ protokol s n√°sleduj√≠c√≠mi √∫daji:

üìã ID protokolu: ${formData.formId}
üìÖ Datum ud√°losti: ${formData.incident.date} ${formData.incident.time}
üìç M√≠sto: ${formData.location.address}
üí• Po≈°kozen√≠: ${formData.damage.type}
üí∞ ≈†koda: ${formData.estimatedDamage.amount} ${formData.estimatedDamage.currency}

üë§ Oznamovatel: ${formData.reporter.name} (${formData.reporter.position})
‚ö†Ô∏è Vin√≠k: ${formData.perpetrator.name} (${formData.perpetrator.position})

üìÑ Kompletn√≠ protokol najdete v p≈ô√≠loze PDF.

S pozdravem,
Syst√©m ≈°kodn√≠ch protokol≈Ø Rohlik.cz
                `,
                
                // PDF p≈ô√≠loha
                attachmentName: pdfData.filename,
                attachmentContent: pdfData.content, // base64 PDF data
                attachmentMimeType: 'application/pdf',
                
                // Metadata pro rozli≈°en√≠
                incidentDate: formData.incident.date,
                incidentTime: formData.incident.time,
                reporterName: formData.reporter.name,
                perpetratorName: formData.perpetrator.name,
                locationAddress: formData.location.address,
                damageType: formData.damage.type,
                estimatedAmount: formData.estimatedDamage.amount,
                estimatedCurrency: formData.estimatedDamage.currency,
                
                // Flags pro Make
                actionType: 'sendEmail',
                hasPDFAttachment: true,
                pdfSize: pdfData.content.length
            };
            
            return fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(makeData)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(`HTTP ${response.status}: ${text}`);
                    });
                }
                return response.text().then(text => {
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        return { success: true, response: text };
                    }
                });
            });
        }

        // Funkce pro generov√°n√≠ textov√©ho reportu
        function generateTextReport(formData) {
            return `≈†KODN√ç PROTOKOL - ${formData.company}
=====================================

ID protokolu: ${formData.formId}
Datum vytvo≈ôen√≠: ${formData.reportTime}

√öDAJE O UD√ÅLOSTI
===============
Datum ud√°losti: ${formData.incident.date}
ƒåas ud√°losti: ${formData.incident.time}

KDO UD√ÅLOST OZN√ÅMIL
==================
Jm√©no: ${formData.reporter.name}
Pozice: ${formData.reporter.position}
Osobn√≠ ƒç√≠slo: ${formData.reporter.employeeId}
Firma: ${formData.reporter.company}

KDO UD√ÅLOST ZP≈ÆSOBIL
===================
Jm√©no: ${formData.perpetrator.name}
Pozice: ${formData.perpetrator.position}
Osobn√≠ ƒç√≠slo: ${formData.perpetrator.employeeId}
Firma: ${formData.perpetrator.company}

M√çSTO UD√ÅLOSTI
=============
Adresa: ${formData.location.address}
P≈ôesn√© m√≠sto: ${formData.location.detail}

PO≈†KOZEN√ç
=========
Typ: ${formData.damage.type}
Popis: ${formData.damage.description}

P≈ò√çƒåINA
=======
Typ: ${formData.cause.type}
Detailn√≠ popis: ${formData.cause.detail}

≈†KODA
=====
V√Ω≈°e: ${formData.estimatedDamage.amount} ${formData.estimatedDamage.currency}

${formData.perpetratorStatement ? `VYJ√ÅD≈òEN√ç VIN√çKA
================
${formData.perpetratorStatement}` : ''}

PODPISY
=======
Podpis vin√≠ka: ${formData.signatures.perpetrator && !formData.signatures.perpetrator.isEmpty ? 'P≈ô√≠tomen' : 'Chyb√≠'}
Podpis vedouc√≠ho: ${formData.signatures.supervisor && !formData.signatures.supervisor.isEmpty ? 'P≈ô√≠tomen' : 'Chyb√≠'}

Fotografie: ${formData.photos.length} p≈ôilo≈æen√Ωch soubor≈Ø

=====================================
Vygenerov√°no: ${new Date().toLocaleString('cs-CZ')}`;
        }

        // Funkce pro generov√°n√≠ HTML pro PDF
        function generateHTMLForPDF(formData) {
            return `
<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #00c851; color: white; padding: 20px; text-align: center; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .label { font-weight: bold; color: #333; }
        .value { margin-left: 10px; }
        .row { display: flex; gap: 20px; margin: 10px 0; }
        .col { flex: 1; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Z√°znam o ≈°kodn√≠ ud√°losti</h1>
        <h2>Rohlik.cz</h2>
    </div>
    
    <div class="section">
        <div class="label">ID protokolu:</div>
        <div class="value">${formData.formId}</div>
    </div>
    
    <div class="section">
        <div class="label">Kdy do≈°lo k ozn√°men√≠:</div>
        <div class="value">${formData.reportTime}</div>
    </div>
    
    <div class="section">
        <h3>Kdy do≈°lo k ud√°losti</h3>
        <div class="row">
            <div class="col"><span class="label">Datum:</span> ${formData.incident.date}</div>
            <div class="col"><span class="label">ƒåas:</span> ${formData.incident.time}</div>
        </div>
    </div>
    
    <div class="section">
        <h3>Kdo ud√°lost ozn√°mil</h3>
        <div class="row">
            <div class="col"><span class="label">Jm√©no:</span> ${formData.reporter.name}</div>
            <div class="col"><span class="label">Pozice:</span> ${formData.reporter.position}</div>
        </div>
        <div class="row">
            <div class="col"><span class="label">Os. ƒç.:</span> ${formData.reporter.employeeId}</div>
            <div class="col"><span class="label">Firma:</span> ${formData.reporter.company}</div>
        </div>
    </div>
    
    <div class="section">
        <h3>Kdo ud√°lost zp≈Øsobil</h3>
        <div class="row">
            <div class="col"><span class="label">Jm√©no:</span> ${formData.perpetrator.name}</div>
            <div class="col"><span class="label">Pozice:</span> ${formData.perpetrator.position}</div>
        </div>
        <div class="row">
            <div class="col"><span class="label">Os. ƒç.:</span> ${formData.perpetrator.employeeId}</div>
            <div class="col"><span class="label">Firma:</span> ${formData.perpetrator.company}</div>
        </div>
    </div>
    
    <div class="section">
        <h3>Kde k ud√°losti do≈°lo</h3>
        <div class="label">Adresa:</div>
        <div class="value">${formData.location.address}</div>
        <div class="label">P≈ôesn√© m√≠sto:</div>
        <div class="value">${formData.location.detail}</div>
    </div>
    
    <div class="section">
        <h3>Co bylo po≈°kozeno</h3>
        <div class="label">Typ:</div>
        <div class="value">${formData.damage.type}</div>
        <div class="label">Popis:</div>
        <div class="value">${formData.damage.description}</div>
    </div>
    
    <div class="section">
        <h3>Jak do≈°lo k ud√°losti</h3>
        <div class="label">P≈ô√≠ƒçina:</div>
        <div class="value">${formData.cause.type}</div>
        <div class="label">Detailn√≠ popis:</div>
        <div class="value">${formData.cause.detail}</div>
    </div>
    
    <div class="section">
        <h3>Odhadovan√° ≈°koda</h3>
        <div class="value">${formData.estimatedDamage.amount} ${formData.estimatedDamage.currency}</div>
    </div>
    
    ${formData.perpetratorStatement ? `
    <div class="section">
        <h3>Vyj√°d≈ôen√≠ vin√≠ka</h3>
        <div class="value">${formData.perpetratorStatement}</div>
    </div>
    ` : ''}
    
    <div class="section">
        <div class="label">Vygenerov√°no:</div>
        <div class="value">${new Date().toLocaleString('cs-CZ')}</div>
    </div>
</body>
</html>`;
        }

        // Vylep≈°en√© odesl√°n√≠ formul√°≈ôe - PDF generov√°n√≠ v prohl√≠≈æeƒçi
        async function submitForm() {
            const submitBtn = document.querySelector('.submit-btn');
            const container = document.querySelector('.container');
            
            // Kontrola povinn√Ωch pol√≠
            const requiredFields = [
                'incident-date', 'incident-time-input', 
                'reporter-name', 'reporter-position', 'reporter-id', 'reporter-company',
                'perpetrator-name', 'perpetrator-position', 'perpetrator-id', 'perpetrator-company',
                'location', 'location-detail', 'damage-type', 'damage-description',
                'cause-type', 'cause-detail', 'estimated-damage'
            ];
            
            let isValid = true;
            const missingFields = [];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim()) {
                    isValid = false;
                    const label = field?.previousElementSibling?.textContent || fieldId;
                    missingFields.push(label);
                    if (field) {
                        field.style.borderColor = '#e74c3c';
                        field.style.animation = 'shake 0.5s ease-in-out';
                    }
                } else {
                    if (field) field.style.borderColor = '#e9ecef';
                }
            });
            
            // Kontrola podpis≈Ø
            const perpetratorCanvas = document.getElementById('signature-perpetrator');
            const supervisorCanvas = document.getElementById('signature-supervisor');
            
            if (perpetratorCanvas && isCanvasEmpty(perpetratorCanvas)) {
                isValid = false;
                missingFields.push('‚úçÔ∏è Podpis vin√≠ka');
                perpetratorCanvas.style.borderColor = '#e74c3c';
                perpetratorCanvas.style.animation = 'shake 0.5s ease-in-out';
            } else if (perpetratorCanvas) {
                perpetratorCanvas.style.borderColor = '#ccc';
            }
            
            if (supervisorCanvas && isCanvasEmpty(supervisorCanvas)) {
                isValid = false;
                missingFields.push('‚úçÔ∏è Podpis security/vedouc√≠ho');
                supervisorCanvas.style.borderColor = '#e74c3c';
                supervisorCanvas.style.animation = 'shake 0.5s ease-in-out';
            } else if (supervisorCanvas) {
                supervisorCanvas.style.borderColor = '#ccc';
            }
            
            if (!isValid) {
                alert('‚ùå Pros√≠m vypl≈àte v≈°echna povinn√° pole a podpisy:\n\n' + missingFields.join('\n'));
                
                // Scroll k prvn√≠mu chybƒõj√≠c√≠mu podpisu
                if (perpetratorCanvas && isCanvasEmpty(perpetratorCanvas)) {
                    perpetratorCanvas.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else if (supervisorCanvas && isCanvasEmpty(supervisorCanvas)) {
                    supervisorCanvas.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                
                return;
            }
            
            // Animace naƒç√≠t√°n√≠
            submitBtn.innerHTML = '‚è≥ Generuji PDF...';
            submitBtn.style.background = 'linear-gradient(135deg, #636e72 0%, #2d3436 100%)';
            container.classList.add('loading');
            
            try {
                // Sbƒõr dat z formul√°≈ôe
                const formData = collectFormData();
                
                // Generov√°n√≠ PDF v prohl√≠≈æeƒçi
                const pdfData = await generatePDFData(formData);
                
                submitBtn.innerHTML = '‚è≥ Odes√≠l√°m PDF...';
                
                // Odesl√°n√≠ PDF emailem
                const response = await sendPDFEmail(formData, pdfData);
                
                // √öspƒõ≈°n√© odesl√°n√≠
                submitBtn.innerHTML = '‚úÖ PDF odesl√°no!';
                submitBtn.style.background = 'linear-gradient(135deg, #00b894 0%, #00a085 100%)';
                container.classList.remove('loading');
                container.classList.add('success-animation');
                
                setTimeout(() => {
                    alert('‚úÖ PDF protokol byl √∫spƒõ≈°nƒõ vygenerov√°n a odesl√°n emailem!\n\n' +
                          'üìß Email s PDF: ' + pdfData.filename + '\n' +
                          'üÜî ID formul√°≈ôe: ' + formData.formId + '\n' +
                          'üìÆ Odesl√°no na: david.rok@outlook.com');
                    
                    // Nab√≠dka lok√°ln√≠ kopie
                    const saveLocal = confirm('üíæ Chcete si tak√© ulo≈æit lok√°ln√≠ kopii PDF?');
                    
                    if (saveLocal) {
                        // Spust√≠ print dialog pro lok√°ln√≠ ulo≈æen√≠
                        preparePrintVersion();
                        setTimeout(() => {
                            window.print();
                            setTimeout(() => {
                                restoreNormalVersion();
                            }, 1000);
                        }, 500);
                    }
                    
                    // Reset tlaƒç√≠tka
                    setTimeout(() => {
                        submitBtn.innerHTML = 'üöÄ Odeslat ≈°kodn√≠ protokol';
                        submitBtn.style.background = 'linear-gradient(135deg, #00c851 0%, #ff6900 100%)';
                        container.classList.remove('success-animation');
                    }, 3000);
                }, 1000);
                
            } catch (error) {
                // Chyba p≈ôi generov√°n√≠ nebo odes√≠l√°n√≠
                submitBtn.innerHTML = '‚ùå Chyba p≈ôi odes√≠l√°n√≠';
                submitBtn.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                container.classList.remove('loading');
                
                alert('‚ùå Chyba p≈ôi generov√°n√≠ nebo odes√≠l√°n√≠ PDF:\n' + error.message + 
                      '\n\nüí° Zkuste to pros√≠m znovu.');
                
                // Reset tlaƒç√≠tka po chybƒõ
                setTimeout(() => {
                    submitBtn.innerHTML = 'üöÄ Odeslat ≈°kodn√≠ protokol';
                    submitBtn.style.background = 'linear-gradient(135deg, #00c851 0%, #ff6900 100%)';
                }, 3000);
            }
        }
        
        // Funkce pro p≈ô√≠pravu verze na tisk
        function preparePrintVersion() {
            // P≈ôid√°n√≠ datum a ƒçasu tisku
            const printInfo = document.createElement('div');
            printInfo.id = 'print-info';
            printInfo.innerHTML = `<p style="font-size: 10pt; color: #666; text-align: right; margin: 10mm 15mm;">Vyti≈°tƒõno: ${new Date().toLocaleString('cs-CZ')}</p>`;
            document.querySelector('.form-content').appendChild(printInfo);
            
            // Oznaƒçen√≠ dlouh√Ωch sekc√≠ pro mo≈æn√© dƒõlen√≠ str√°nek
            const longSections = document.querySelectorAll('.form-section');
            longSections.forEach(section => {
                if (section.offsetHeight > 200) {
                    section.classList.add('allow-break');
                }
            });
        }
        
        // Funkce pro obnoven√≠ norm√°ln√≠ verze
        function restoreNormalVersion() {
            // Odstranƒõn√≠ print info
            const printInfo = document.getElementById('print-info');
            if (printInfo) {
                printInfo.remove();
            }
            
            // Odstranƒõn√≠ allow-break t≈ô√≠d
            const breakSections = document.querySelectorAll('.allow-break');
            breakSections.forEach(section => {
                section.classList.remove('allow-break');
            });
        }
        
        // Funkce pro manu√°ln√≠ export do PDF
        function exportToPDF() {
            preparePrintVersion();
            setTimeout(() => {
                window.print();
                setTimeout(() => {
                    restoreNormalVersion();
                }, 1000);
            }, 500);
        }
        
        // Responzivn√≠ √∫prava podpisov√Ωch p√°d≈Ø
        window.addEventListener('resize', function() {
            setTimeout(() => {
                initSignaturePad('signature-perpetrator');
                initSignaturePad('signature-supervisor');
            }, 200);
        });
        
        // CSS animace pro chybƒõj√≠c√≠ pole
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>